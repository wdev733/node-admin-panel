/*! pi1 - v1.0.0 -  2017 - 01 - 24  */
$.ajaxSetup({cache:!1});var domainList={};!function(dList){const token=$("#token").html(),listType=$("#list-type").html(),fullName="white"===listType?"Whitelist":"Blacklist",alInfo=$("#alInfo"),alSuccess=$("#alSuccess"),alFailure=$("#alFailure"),domain=$("#domain"),list=$("#list"),addCallbacks={success:function(response){response.indexOf("not a valid argument")>=0||response.indexOf("is not a valid domain")>=0?(alFailure.show(),alFailure.delay(1e3).fadeOut(2e3,function(){alFailure.hide()}),alInfo.delay(1e3).fadeOut(2e3,function(){alInfo.hide()})):(alSuccess.show(),alSuccess.delay(1e3).fadeOut(2e3,function(){alSuccess.hide()}),alInfo.delay(1e3).fadeOut(2e3,function(){alInfo.hide()}),domain.val(""),dList.refresh(!0))},error:function(jqXHR,exception){alFailure.show(),alFailure.delay(1e3).fadeOut(2e3,function(){alFailure.hide()}),alInfo.delay(1e3).fadeOut(2e3,function(){alInfo.hide()})}},subCallbacks={error:function(jqXHR,exception){domain.show({queue:!0}),alert("Failed to remove the domain!")},success:function(response){0===response.length&&domain.remove()}},refreshCallbacks={success:function(data){list.html(""),0===data.length?list.html('<div class="alert alert-info" role="alert">Your '+fullName+" is empty!</div>"):data.forEach(function(entry,index){list.append('<li id="'+index+'" class="list-group-item clearfix">'+entry+'<button class="btn btn-danger btn-xs pull-right" type="button"><span class="glyphicon glyphicon-trash"></span></button></li>'),$("#list #"+index).on("click","button",function(){dList.sub(index,entry)})}),list.fadeIn("fast")},error:function(jqXHR,exception){$("#alFailure").show()}};dList.add=function(){0!==domain.val().length&&(alInfo.show(),alSuccess.hide(),alFailure.hide(),$.ajax({url:"api/list",method:"post",data:{domain:domain.val(),list:listType,token:token},success:addCallbacks.success,error:addCallbacks.error}))},dList.sub=function(index,entry){domain.hide("highlight"),$.ajax({url:"api/list",method:"delete",data:{domain:entry,list:listType,token:token},success:subCallbacks.success,error:subCallbacks.error})},dList.refresh=function(fade){fade&&list.fadeOut(100),$.ajax({url:"/api/list",method:"get",data:{list:listType},success:refreshCallbacks.success,error:refreshCallbacks.error})}}(domainList),window.onload=domainList.refresh(!1),$(document).keypress(function(e){13===e.which&&$("#domain").is(":focus")&&domainList.add()}),$("#btnAdd").on("click",function(){domainList.add()}),$("#btnRefresh").on("click",function(){domainList.refresh(!0)}),$(function(){$("[data-hide]").on("click",function(){$(this).closest("."+$(this).attr("data-hide")).hide()})});