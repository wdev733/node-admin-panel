/*! pi1 - v1.0.0 -  2017 - 01 - 24  */
function piholeChanged(action){const status=$("#status"),ena=$("#pihole-enable"),dis=$("#pihole-disable");switch(action){case"enabled":status.html("<i class='fa fa-circle' style='color:#7FFF00'></i> Active"),ena.hide(),dis.show(),dis.removeClass("active");break;case"disabled":status.html("<i class='fa fa-circle' style='color:#FF0000'></i> Offline"),ena.show(),dis.hide()}}function piholeChange(action,duration){const token=encodeURIComponent($("#token").html());var btnStatus;switch(action){case"enable":btnStatus=$("#flip-status-enable"),btnStatus.html("<i class='fa fa-spinner'> </i>"),$.post("api/enable",{token:token},function(res){"enabled"===res.status&&(btnStatus.html(""),piholeChanged("enabled"))});break;case"disable":btnStatus=$("#flip-status-disable"),btnStatus.html("<i class='fa fa-spinner'> </i>"),$.post("api/disable",{token:token,time:duration},function(res){"disabled"===res.status&&(btnStatus.html(""),piholeChanged("disabled"))},"json")}}function versionCompare(left,right){if(typeof left+typeof right!="stringstring")return!1;if("vDev"===left)return 1;for(var aa=left.split("v"),bb=right.split("v"),a=aa[aa.length-1].split("."),b=bb[bb.length-1].split("."),i=0,len=Math.max(a.length,b.length);i<len;i++){if(a[i]&&!b[i]&&parseInt(a[i])>0||parseInt(a[i])>parseInt(b[i]))return 1;if(b[i]&&!a[i]&&parseInt(b[i])>0||parseInt(a[i])<parseInt(b[i]))return-1}return 0}function updateSessionTimer(){start=new Date,start.setSeconds(start.getSeconds()+sessionvalidity)}$("#dropdown-menu a").on("click",function(event){$(this).parent().toggleClass("open")}),$("body").on("click",function(event){$("#dropdown-menu").is(event.target)||0!==$("#dropdown-menu").has(event.target).length||$("#dropdown-menu").removeClass("open")}),$("#pihole-enable").on("click",function(e){e.preventDefault(),piholeChange("enable","")}),$("#pihole-disable-permanently").on("click",function(e){e.preventDefault(),piholeChange("disable","0")}),$("#pihole-disable-10s").on("click",function(e){e.preventDefault(),piholeChange("disable","10"),setTimeout(function(){piholeChanged("enabled")},1e4)}),$("#pihole-disable-30s").on("click",function(e){e.preventDefault(),piholeChange("disable","30"),setTimeout(function(){piholeChanged("enabled")},3e4)}),$("#pihole-disable-5m").on("click",function(e){e.preventDefault(),piholeChange("disable","300"),setTimeout(function(){piholeChanged("enabled")},3e5)});var piholeVersion=$("#piholeVersion").html(),webVersion=$("#webVersion").html();$.getJSON("https://api.github.com/repos/pi-hole/pi-hole/releases/latest",function(json){versionCompare(piholeVersion,json.tag_name.slice(1))<0&&($("#piholeVersion").html($("#piholeVersion").text()+'<a class="alert-link" href="https://github.com/pi-hole/pi-hole/releases">(Update available!)</a>'),$("#alPiholeUpdate").show())}),$.getJSON("https://api.github.com/repos/pi-hole/AdminLTE/releases/latest",function(json){versionCompare(webVersion,json.tag_name.slice(1))<0&&($("#webVersion").html($("#webVersion").text()+'<a class="alert-link" href="https://github.com/pi-hole/adminLTE/releases">(Update available!)</a>'),$("#alWebUpdate").show())}),versionCompare(piholeVersion,"v2.7")<0&&alert("Pi-hole needs to be updated to at least v2.7 before you can use features such as whitelisting/blacklisting from this web interface!");var sessionvalidity=parseInt(document.getElementById("sessiontimercounter").textContent),start=new Date;sessionvalidity>0?(updateSessionTimer(),setInterval(function(){var current=new Date,totalseconds=(start-current)/1e3,minutes=Math.floor(totalseconds/60);minutes<10&&(minutes="0"+minutes);var seconds=Math.floor(totalseconds%60);seconds<10&&(seconds="0"+seconds),totalseconds>0?document.getElementById("sessiontimercounter").textContent=minutes+":"+seconds:document.getElementById("sessiontimercounter").textContent="-- : --"},1e3)):document.getElementById("sessiontimer").style.display="none",versionCompare(piholeVersion,"v2.9.5")<1&&$("#btnSearchExact").hide(),$(document).keypress(function(e){(10===e.keyCode||13===e.keyCode)&&e.ctrlKey&&$("#loginpw").is(":focus")&&($("#loginform").attr("action","settings.php"),$("#loginform").submit())});