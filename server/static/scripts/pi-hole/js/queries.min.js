/*! pi1 - v1.0.0 -  2017 - 01 - 24  */
function escapeRegex(text){var map={"(":"\\(",")":"\\)",".":"\\."};return text.replace(/[().]/g,function(m){return map[m]})}function setTableLoading(loading){loading!==tableIsLoading&&(tableIsLoading=loading,loading?$("#recent-queries .overlay").show():$("#recent-queries .overlay").hide())}function refreshData(){tableApi.ajax.url("/api/data?getAllQueries").load()}function add(row){var rowData=row.data(),token=$("#token").html(),alInfo=$("#alInfo"),alList=$("#alList"),alDomain=$("#alDomain");alDomain.html(rowData.domain);var list,alSuccess=$("#alSuccess"),alFailure=$("#alFailure");"Pi-holed"===rowData.status?(list="white",alList.html("Whitelist")):(list="black",alList.html("Blacklist")),alInfo.show(),alSuccess.hide(),alFailure.hide(),setTableLoading(!0),$.ajax({url:"scripts/pi-hole/php/add.php",method:"post",data:{domain:rowData.domain,list:list,token:token},success:function(response){response.indexOf("not a valid argument")>=0||response.indexOf("is not a valid domain")>=0?(alFailure.show(),alFailure.delay(1e3).fadeOut(2e3,function(){alFailure.hide()})):("Pi-holed"===rowData.status?rowData.status="Ok":rowData.status="Pi-holed",row.data(rowData).draw(),alSuccess.show(),alSuccess.delay(1e3).fadeOut(2e3,function(){alSuccess.hide()})),alInfo.delay(1e3).fadeOut(2e3,function(){alInfo.hide(),alList.html(""),alDomain.html("")}),setTableLoading(!1)},error:function(jqXHR,exception){alFailure.show(),alFailure.delay(1e3).fadeOut(2e3,function(){alFailure.hide()}),alInfo.delay(1e3).fadeOut(2e3,function(){alInfo.hide(),alList.html(""),alDomain.html("")}),setTableLoading(!1)}})}var tableApi,tableIsLoading=!0;$(document).ready(function(){var GETDict={};location.search.substr(1).split("&").forEach(function(item){GETDict[item.split("=")[0]]=item.split("=")[1]});var APIstring="/api/data?getAllQueries";"from"in GETDict&&(APIstring+="&from="+GETDict.from),"until"in GETDict&&(APIstring+="&until="+GETDict.until),tableApi=$("#all-queries").DataTable({rowCallback:function(row,data,index){"Pi-holed"===data.status?($(row).css("color","red"),$("td:eq(5)",row).html('<button style="color:green;"><i class="fa fa-pencil-square-o"></i> Whitelist</button>')):($(row).css("color","green"),$("td:eq(5)",row).html('<button style="color:red;"><i class="fa fa-ban"></i> Blacklist</button>'))},initComplete:function(settings,json){setTableLoading(!1)},dom:"<'row'<'col-sm-12'f>><'row'<'col-sm-4'l><'col-sm-8'p>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",ajax:APIstring,autoWidth:!1,order:[[0,"desc"]],columns:[{width:"20%",data:"time",type:"date"},{width:"10%",data:"type"},{width:"40%",data:"domain"},{width:"10%",data:"client"},{width:"10%",data:"status"},{width:"10%",data:"action"}],lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],columnDefs:[{targets:-1,data:null,defaultContent:""}]}),$("#all-queries tbody").on("click","button",function(){var row=tableApi.row($(this).parents("tr"));add(row)}),"client"in GETDict&&tableApi.column(3).search("^"+escapeRegex(GETDict.client)+"$",!0,!1),"domain"in GETDict&&tableApi.column(2).search("^"+escapeRegex(GETDict.domain)+"$",!0,!1)});