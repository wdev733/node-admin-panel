/*! pi1 - v1.0.0 -  2017 - 01 - 26  */
function escapeRegex(a){var b={"(":"\\(",")":"\\)",".":"\\."};return a.replace(/[().]/g,function(a){return b[a]})}function setTableLoading(a){a!==tableIsLoading&&(tableIsLoading=a,a?$("#recent-queries .overlay").show():$("#recent-queries .overlay").hide())}function refreshData(){tableApi.ajax.url("/api/data?allQueries").load()}function add(a){var b=a.data(),c=$("#token").html(),d=$("#alInfo"),e=$("#alList"),f=$("#alDomain");f.html(b.domain);var g,h=$("#alSuccess"),i=$("#alFailure");"Pi-holed"===b.status?(g="white",e.html("Whitelist")):(g="black",e.html("Blacklist")),d.show(),h.hide(),i.hide(),setTableLoading(!0),$.ajax({url:"scripts/pi-hole/php/add.php",method:"post",data:{domain:b.domain,list:g,token:c},success:function(c){c.indexOf("not a valid argument")>=0||c.indexOf("is not a valid domain")>=0?(i.show(),i.delay(1e3).fadeOut(2e3,function(){i.hide()})):("Pi-holed"===b.status?b.status="Ok":b.status="Pi-holed",a.data(b).draw(),h.show(),h.delay(1e3).fadeOut(2e3,function(){h.hide()})),d.delay(1e3).fadeOut(2e3,function(){d.hide(),e.html(""),f.html("")}),setTableLoading(!1)},error:function(a,b){i.show(),i.delay(1e3).fadeOut(2e3,function(){i.hide()}),d.delay(1e3).fadeOut(2e3,function(){d.hide(),e.html(""),f.html("")}),setTableLoading(!1)}})}var tableApi,tableIsLoading=!0;$(document).ready(function(){var a={};location.search.substr(1).split("&").forEach(function(b){a[b.split("=")[0]]=b.split("=")[1]});var b="/api/data?allQueries";"from"in a&&(b+="&from="+a.from),"until"in a&&(b+="&until="+a.until),tableApi=$("#all-queries").DataTable({rowCallback:function(a,b,c){"Pi-holed"===b.status?($(a).css("color","red"),$("td:eq(5)",a).html('<button style="color:green;"><i class="fa fa-pencil-square-o"></i> Whitelist</button>')):($(a).css("color","green"),$("td:eq(5)",a).html('<button style="color:red;"><i class="fa fa-ban"></i> Blacklist</button>'))},initComplete:function(a,b){setTableLoading(!1)},dom:"<'row'<'col-sm-12'f>><'row'<'col-sm-4'l><'col-sm-8'p>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",ajax:{url:b,dataSrc:"allQueries"},autoWidth:!1,order:[[0,"desc"]],columns:[{width:"20%",data:"time",type:"date"},{width:"10%",data:"type"},{width:"40%",data:"domain"},{width:"10%",data:"client"},{width:"10%",data:"status"},{width:"10%",data:"action"}],lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],columnDefs:[{targets:-1,data:null,defaultContent:""}]}),$("#all-queries tbody").on("click","button",function(){var a=tableApi.row($(this).parents("tr"));add(a)}),"client"in a&&tableApi.column(3).search("^"+escapeRegex(a.client)+"$",!0,!1),"domain"in a&&tableApi.column(2).search("^"+escapeRegex(a.domain)+"$",!0,!1)});